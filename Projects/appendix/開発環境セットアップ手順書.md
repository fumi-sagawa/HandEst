# HandEst 開発環境セットアップ手順書

## 1. 概要

本文書は、HandEstプロジェクトの開発環境構築手順を詳しく説明します。新規メンバーが効率的に開発に参加できるよう、必要なツール・設定・確認事項を網羅しています。

## 2. 前提条件・システム要件

### 2.1 ハードウェア要件
- **Mac**: macOS 14.0 (Sonoma) 以降
- **メモリ**: 16GB以上推奨（8GB最小）
- **ストレージ**: 50GB以上の空き容量
- **プロセッサ**: Apple Silicon (M1/M2/M3) または Intel Core i5以上

### 2.2 必須アカウント
- **Apple Developer Account**: iOS開発・実機テスト用
- **GitHub Account**: ソースコード管理用
- **TestFlight Access**: ベータテスト配布用（内部テスター）

## 3. 基本開発ツールのインストール

### 3.1 Xcode

#### インストール手順
1. **App Storeからインストール**
   ```bash
   # App Storeを開く
   open "macappstore://apps.apple.com/app/xcode/id497799835"
   ```

2. **コマンドラインツールのインストール**
   ```bash
   # Xcodeコマンドラインツールをインストール
   xcode-select --install
   
   # インストール確認
   xcode-select -p
   # 期待する出力: /Applications/Xcode.app/Contents/Developer
   ```

3. **必要なシミュレータの追加**
   - Xcode → Preferences → Components
   - iOS 16.0, 17.0, 18.2 Simulatorをダウンロード

#### バージョン要件
- **Xcode**: 15.0以上
- **Swift**: 5.9以上
- **iOS Deployment Target**: 18.2

### 3.2 XcodeGen

#### インストール
```bash
# Homebrewを使用してインストール
brew install xcodegen

# インストール確認
xcodegen --version
# 期待する出力: 2.38.0以上
```

#### プロジェクト生成
```bash
# プロジェクトルートで実行
cd /path/to/HandEst
xcodegen generate

# Xcodeプロジェクトが生成されることを確認
ls -la HandEst.xcodeproj
```

### 3.3 Git設定

#### Git初期設定
```bash
# ユーザー情報設定
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"

# 改行コード設定（Macの場合）
git config --global core.autocrlf input

# デフォルトブランチ設定
git config --global init.defaultBranch main
```

#### リポジトリクローン
```bash
# プロジェクトをクローン
git clone https://github.com/username/HandEst.git
cd HandEst

# 開発ブランチに切り替え
git checkout develop
```

## 4. プロジェクト固有の設定

### 4.1 The Composable Architecture (TCA)

#### Swift Package依存関係の解決
```bash
# Xcodeでプロジェクトを開く
open HandEst.xcodeproj

# Package Dependencies画面で依存関係を解決
# File → Add Package Dependencies → 
# https://github.com/pointfreeco/swift-composable-architecture
```

#### TCAバージョン確認
```swift
// Package.swiftで確認
dependencies: [
    .package(url: "https://github.com/pointfreeco/swift-composable-architecture", from: "1.0.0")
]
```

### 4.2 コード品質管理ツール

#### SwiftLint

**インストール**
```bash
# Homebrewでインストール
brew install swiftlint

# インストール確認
swiftlint version
# 期待する出力: 0.50.0以上
```

**設定ファイル確認**
```bash
# .swiftlint.ymlが存在することを確認
ls -la .swiftlint.yml

# 設定内容の確認
cat .swiftlint.yml
```

**手動実行テスト**
```bash
# プロジェクトルートでSwiftLintを実行
swiftlint

# 期待する出力: エラーなし、または修正可能な警告のみ
```

#### Git Hooks

**自動インストール**
```bash
# pre-commit hookの自動インストール
./Scripts/install-hooks.sh

# 実行権限確認
ls -la .git/hooks/pre-commit
# 期待する出力: -rwxr-xr-x（実行権限付き）
```

**手動インストール（必要な場合）**
```bash
# Git hookディレクトリに移動
cd .git/hooks

# pre-commit hookをコピー
cp ../../Scripts/git-hooks/pre-commit ./pre-commit

# 実行権限を付与
chmod +x pre-commit
```

**動作確認**
```bash
# テストコミットで動作確認
git add .
git commit -m "test: pre-commit hook動作確認"

# 期待する動作:
# 1. SwiftLintチェック実行
# 2. テスト実行
# 3. ビルド確認
# 4. 全て成功した場合のみコミット実行
```

## 5. MediaPipe準備

### 5.1 MediaPipe Framework

#### 依存関係の準備
```bash
# MediaPipe iOS Frameworkの準備
# （具体的な統合方法は MediaPipe統合検証計画書.md を参照）

# 1. CocoaPodsまたはSPMでの追加
# 2. Framework手動追加
# 3. バイナリサイズの確認
```

#### 統合確認用サンプルコード
```swift
// MediaPipe基本統合テスト用
import MediaPipeTasksVision

class MediaPipeSetupValidator {
    func validateMediaPipeInstallation() -> Bool {
        // MediaPipeライブラリの基本的な初期化テスト
        do {
            let handLandmarker = try HandLandmarker(options: HandLandmarkerOptions())
            print("✅ MediaPipe正常にインストールされています")
            return true
        } catch {
            print("❌ MediaPipeインストールエラー: \(error)")
            return false
        }
    }
}
```

### 5.2 RealityKit準備

#### 基本機能確認
```swift
// RealityKit動作確認用サンプル
import RealityKit
import ARKit

class RealityKitValidator {
    func validateRealityKitSupport() -> Bool {
        // デバイスがRealityKitをサポートするか確認
        if ARWorldTrackingConfiguration.isSupported {
            print("✅ RealityKitがサポートされています")
            return true
        } else {
            print("❌ RealityKitがサポートされていません")
            return false
        }
    }
}
```

## 6. ビルド・テスト環境確認

### 6.1 基本ビルド確認

```bash
# プロジェクトをクリーンビルド
xcodebuild -scheme HandEst -configuration Debug clean build

# 期待する結果: BUILD SUCCEEDED

# リリースビルドも確認
xcodebuild -scheme HandEst -configuration Release clean build

# 期待する結果: BUILD SUCCEEDED
```

### 6.2 テスト実行確認

```bash
# 全テストを実行
xcodebuild -scheme HandEst test

# 期待する結果: Test Succeeded

# 並列テスト実行の確認
xcodebuild -scheme HandEst test -parallelizeTargets -jobs 8

# 期待する結果: より高速なテスト実行
```

### 6.3 シミュレータでの動作確認

```bash
# 特定のシミュレータでビルド・実行
xcodebuild -scheme HandEst -destination 'platform=iOS Simulator,name=iPhone 15' build

# 期待する結果: BUILD SUCCEEDED

# シミュレータを起動してアプリ確認
open -a Simulator
```

## 7. 実機テスト環境構築

### 7.1 デバイス設定

#### iPhoneの準備
1. **開発者モード有効化**
   - 設定 → プライバシーとセキュリティ → 開発者モード → オン

2. **デバイスをXcodeに追加**
   - Xcode → Window → Devices and Simulators
   - デバイスを接続してペアリング

3. **Provisioning Profile設定**
   - 自動署名を有効化（開発時）
   - Team: 適切な開発者アカウントを選択

#### カメラテスト用設定
```swift
// 実機でのカメラアクセステスト
class CameraSetupValidator {
    func validateCameraAccess() {
        AVCaptureDevice.requestAccess(for: .video) { granted in
            DispatchQueue.main.async {
                if granted {
                    print("✅ カメラアクセス許可取得")
                } else {
                    print("❌ カメラアクセス拒否")
                }
            }
        }
    }
}
```

### 7.2 実機ビルド確認

```bash
# 実機向けビルド（デバイスUDIDを指定）
xcodebuild -scheme HandEst -destination 'platform=iOS,id=YOUR_DEVICE_UDID' build

# 期待する結果: BUILD SUCCEEDED
```

## 8. 開発ワークフロー確認

### 8.1 ブランチ戦略

```bash
# 開発フロー確認
git branch -a
# 期待する出力:
# * develop
#   main
#   remotes/origin/develop
#   remotes/origin/main

# 新機能ブランチ作成例
git checkout -b feature/001-camera-setup
git push -u origin feature/001-camera-setup
```

### 8.2 品質チェックワークフロー

```bash
# 開発時の品質チェック
./Scripts/quick-check.sh

# 期待する動作:
# 1. SwiftLint実行
# 2. 高速ビルド確認
# 3. 基本テスト実行

# フルチェック（コミット前）
# Git hookが自動実行するが、手動でも実行可能
./Scripts/git-hooks/pre-commit
```

## 9. IDE設定・推奨プラグイン

### 9.1 Xcode設定

#### エディタ設定
```
Xcode → Preferences → Text Editing:
✅ Line numbers
✅ Code folding ribbon
✅ Page guide at column: 120
✅ Automatically trim trailing whitespace
```

#### ビルド設定最適化
```
Xcode → Preferences → Locations:
- Derived Data: Default（高速SSDがあれば外部指定）
- Archives: Default

Build Settings:
- Enable Bitcode: No（MediaPipe互換性のため）
- Swift Compiler - Code Generation:
  - Optimization Level (Debug): No Optimization [-Onone]
  - Optimization Level (Release): Optimize for Speed [-O]
```

### 9.2 推奨ツール

#### ソースコード管理
- **SourceTree**: GitのGUIツール
- **GitHub Desktop**: シンプルなGit操作用

#### デバッグ・プロファイリング
- **Instruments**: パフォーマンス測定
- **Console.app**: デバイスログ確認

## 10. トラブルシューティング

### 10.1 よくある問題と解決方法

#### ビルドエラー
```bash
# Package依存関係リセット
rm -rf ~/Library/Developer/Xcode/DerivedData
xcodebuild -scheme HandEst clean

# Package依存関係再取得
# Xcode → File → Packages → Reset Package Caches
```

#### Git Hook動作しない
```bash
# 実行権限確認・修正
chmod +x .git/hooks/pre-commit
chmod +x Scripts/install-hooks.sh

# hook再インストール
./Scripts/install-hooks.sh
```

#### シミュレータ問題
```bash
# シミュレータリセット
xcrun simctl erase all

# 特定シミュレータのリセット
xcrun simctl erase "iPhone 15"
```

### 10.2 パフォーマンス問題

#### Xcodeの動作が重い場合
```bash
# Derived Dataクリア
rm -rf ~/Library/Developer/Xcode/DerivedData

# Xcodeキャッシュクリア
rm -rf ~/Library/Caches/com.apple.dt.Xcode

# 必要に応じてXcode再起動
```

## 11. セットアップ完了確認

### 11.1 チェックリスト

- [ ] Xcode 15.0以上がインストール済み
- [ ] XcodeGenが正常動作
- [ ] プロジェクトがエラーなしでビルド
- [ ] 全テストが成功実行
- [ ] SwiftLintが正常動作
- [ ] Git Hooksが有効
- [ ] 実機でのビルド確認
- [ ] カメラアクセス確認
- [ ] MediaPipe基本統合確認
- [ ] RealityKit動作確認

### 11.2 最終動作確認

```bash
# セットアップ完了テスト
echo "HandEst開発環境セットアップ完了テスト"
echo "=================================="

# 1. ビルド確認
echo "📱 ビルド確認..."
xcodebuild -scheme HandEst -configuration Debug build -quiet

# 2. テスト実行
echo "🧪 テスト実行..."
xcodebuild -scheme HandEst test -quiet

# 3. SwiftLint確認
echo "📝 コード品質確認..."
swiftlint

echo "✅ 開発環境セットアップ完了！"
echo "次のステップ: Projects/tasks/todo/001-project-setup-architecture.md"
```

## 12. 次のステップ

### 12.1 開発開始準備
1. **タスクファイル確認**: `Projects/tasks/todo/`の内容確認
2. **機能仕様理解**: `Projects/機能要件仕様書.md`の詳読
3. **アーキテクチャ理解**: `Projects/技術方針文書.md`の確認

### 12.2 初回実装推奨
- カメラアクセス基本実装
- TCAの基本Feature作成
- MediaPipe POC実装

---

*文書作成日: 2025-05-28*
*最終更新日: 2025-05-28*