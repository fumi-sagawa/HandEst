# HandEst å“è³ªãƒã‚§ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ è©³ç´°ã‚¬ã‚¤ãƒ‰

## ğŸ“Š å“è³ªãƒã‚§ãƒƒã‚¯ã®å…¨ä½“åƒ

HandEstãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä»¥ä¸‹ã®3å±¤æ§‹é€ ã§å“è³ªã‚’ä¿è¨¼ã—ã¦ã„ã¾ã™ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Layer 3: æ‰‹å‹•ãƒã‚§ãƒƒã‚¯            â”‚
â”‚    (ãƒ—ãƒƒã‚·ãƒ¥å‰ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã®ç¢ºèª)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Layer 2: è‡ªå‹•ãƒã‚§ãƒƒã‚¯            â”‚
â”‚      (ã‚³ãƒŸãƒƒãƒˆæ™‚ãƒ»ãƒ“ãƒ«ãƒ‰æ™‚)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Layer 1: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ             â”‚
â”‚    (ã‚¨ãƒ‡ã‚£ã‚¿ãƒ»IDEä¸Šã§ã®å³æ™‚ç¢ºèª)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš¦ è‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹å“è³ªãƒã‚§ãƒƒã‚¯

### 1. Pre-commit Hookï¼ˆã‚³ãƒŸãƒƒãƒˆå‰ã®è‡ªå‹•ãƒã‚§ãƒƒã‚¯ï¼‰

**å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°**: `git commit`å®Ÿè¡Œæ™‚

**ãƒã‚§ãƒƒã‚¯é …ç›®ã¨é †åº**:

```bash
1. SwiftLintãƒã‚§ãƒƒã‚¯ï¼ˆç´„2-5ç§’ï¼‰
   â””â”€ ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«é•åã‚’æ¤œå‡º

2. ãƒ“ãƒ«ãƒ‰ï¼†ãƒ†ã‚¹ãƒˆï¼ˆç´„1-3åˆ†ï¼‰
   â”œâ”€ ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã®ãƒã‚§ãƒƒã‚¯
   â”œâ”€ å˜ä½“ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
   â””â”€ UIãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

3. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãƒã‚§ãƒƒã‚¯ï¼ˆç´„1-2ç§’ï¼‰
   â””â”€ ç´”ç²‹é–¢æ•°ã¨Reducerã®ãƒ†ã‚¹ãƒˆæœ‰ç„¡ã‚’ç¢ºèª
```

**å¤±æ•—æ™‚ã®æŒ™å‹•**:
- ã„ãšã‚Œã‹ã®ãƒã‚§ãƒƒã‚¯ãŒå¤±æ•—ã—ãŸå ´åˆã€ã‚³ãƒŸãƒƒãƒˆã¯ä¸­æ­¢ã•ã‚Œã¾ã™
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ä¿®æ­£æ–¹æ³•ãŒè¡¨ç¤ºã•ã‚Œã¾ã™

**è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: `/Scripts/git-hooks/pre-commit`

### 2. Xcodeãƒ“ãƒ«ãƒ‰æ™‚ã®ãƒã‚§ãƒƒã‚¯

**å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°**: Xcodeã§ãƒ“ãƒ«ãƒ‰ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚

**ãƒã‚§ãƒƒã‚¯é …ç›®**:
- SwiftLintï¼ˆpreBuildScriptã¨ã—ã¦å®Ÿè¡Œï¼‰
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©è­¦å‘Š
- é™çš„è§£æ

**è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: `project.yml`

### 3. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãƒã‚§ãƒƒã‚¯ã®è©³ç´°

**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**: `Features/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®å…¨Swiftãƒ•ã‚¡ã‚¤ãƒ«

**ãƒã‚§ãƒƒã‚¯å¯¾è±¡ã¨ãªã‚‹è¦ç´ **:

```swift
// 1. TCA Reducerã®reduceé–¢æ•°
struct SomeFeature: Reducer {
    func reduce(into state: inout State, action: Action) -> Effect<Action> {
        // ã“ã®é–¢æ•°ã¯å¿…ãšãƒ†ã‚¹ãƒˆãŒå¿…è¦
    }
}

// 2. public/internalé–¢æ•°
public func calculateSomething(_ value: Int) -> Int {
    // ã“ã®é–¢æ•°ã¯å¿…ãšãƒ†ã‚¹ãƒˆãŒå¿…è¦
}

// 3. è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
internal func validateUserInput(_ input: String) -> ValidationResult {
    // ã“ã®é–¢æ•°ã¯å¿…ãšãƒ†ã‚¹ãƒˆãŒå¿…è¦
}
```

**ãƒ†ã‚¹ãƒˆä¸è¦ãªè¦ç´ **:
- privateé–¢æ•°ï¼ˆå†…éƒ¨å®Ÿè£…ã®è©³ç´°ï¼‰
- å˜ç´”ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
- Viewï¼ˆSwiftUIï¼‰
- ä¾å­˜é–¢ä¿‚ã®ãƒ©ãƒƒãƒ‘ãƒ¼

## ğŸ”§ æ‰‹å‹•å®Ÿè¡Œå¯èƒ½ãªãƒã‚§ãƒƒã‚¯

### é–‹ç™ºãƒ•ãƒ­ãƒ¼åˆ¥ã®æ¨å¥¨ãƒã‚§ãƒƒã‚¯

#### 1. ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ï¼ˆé »ç¹ã«å®Ÿè¡Œï¼‰

```bash
# ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã®ç¢ºèªã®ã¿ï¼ˆæœ€é€Ÿ: 10-30ç§’ï¼‰
./Scripts/quick-check.sh

# ã¾ãŸã¯ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®SwiftLintãƒã‚§ãƒƒã‚¯
swiftlint lint --path Features/Camera/CameraFeature.swift
```

#### 2. æ©Ÿèƒ½å®Ÿè£…å®Œäº†æ™‚

```bash
# é–¢é€£ã™ã‚‹ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
xcodebuild -scheme HandEst test -only-testing:HandEstTests/CameraFeatureTests

# SwiftLintè‡ªå‹•ä¿®æ­£
swiftlint --fix
```

#### 3. ãƒ—ãƒƒã‚·ãƒ¥å‰ï¼ˆå¿…é ˆï¼‰

```bash
# ãƒ•ãƒ«ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
xcodebuild -scheme HandEst test

# å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã®SwiftLintãƒã‚§ãƒƒã‚¯
swiftlint

# ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®ç¢ºèª
./Scripts/check-test-coverage.swift
```

## ğŸ“ å“è³ªåŸºæº–ã¨è¨­å®š

### SwiftLintãƒ«ãƒ¼ãƒ«ï¼ˆä¸»è¦ãªã‚‚ã®ï¼‰

| ãƒ«ãƒ¼ãƒ« | è¨­å®šå€¤ | ç›®çš„ |
|--------|--------|------|
| line_length | 120æ–‡å­— | å¯èª­æ€§ã®ç¢ºä¿ |
| file_length | 400è¡Œ | ãƒ•ã‚¡ã‚¤ãƒ«ã®é©åˆ‡ãªåˆ†å‰² |
| function_body_length | 40è¡Œ | é–¢æ•°ã®è²¬ä»»ç¯„å›²ã®åˆ¶é™ |
| cyclomatic_complexity | 10 | è¤‡é›‘åº¦ã®æŠ‘åˆ¶ |
| force_cast | ã‚¨ãƒ©ãƒ¼ | å®‰å…¨ãªã‚­ãƒ£ã‚¹ãƒˆã®å¼·åˆ¶ |
| force_unwrapping | è­¦å‘Šï¼ˆä¸€éƒ¨è¨±å¯ï¼‰ | nilã®é©åˆ‡ãªå‡¦ç† |

### ãƒ“ãƒ«ãƒ‰æœ€é©åŒ–è¨­å®š

```bash
-parallelizeTargets  # ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ä¸¦åˆ—ãƒ“ãƒ«ãƒ‰
-jobs 8             # 8ä¸¦åˆ—ã§ã®ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ
-quiet              # ä¸è¦ãªå‡ºåŠ›ã‚’æŠ‘åˆ¶
```

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ã®ç›®å®‰

- å˜ä½“ãƒ†ã‚¹ãƒˆ: 10-30ç§’
- UIãƒ†ã‚¹ãƒˆ: 30-60ç§’
- ãƒ•ãƒ«ãƒ†ã‚¹ãƒˆ: 1-3åˆ†

## ğŸš¨ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### å•é¡Œ1: "Line Length Violation"

```swift
// âŒ ã‚¨ãƒ©ãƒ¼: 120æ–‡å­—ã‚’è¶…ãˆã¦ã„ã‚‹
let veryLongVariableName = "This is a very long string that exceeds the maximum line length limit set by SwiftLint rules"

// âœ… è§£æ±ºæ–¹æ³•1: æ”¹è¡Œã™ã‚‹
let veryLongVariableName = """
    This is a very long string that exceeds the maximum 
    line length limit set by SwiftLint rules
    """

// âœ… è§£æ±ºæ–¹æ³•2: ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–ï¼ˆã©ã†ã—ã¦ã‚‚å¿…è¦ãªå ´åˆã®ã¿ï¼‰
// swiftlint:disable:next line_length
let veryLongVariableName = "This is a very long string that exceeds the maximum line length limit set by SwiftLint rules"
```

#### å•é¡Œ2: ãƒ†ã‚¹ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‚¨ãƒ©ãƒ¼

```
âŒ calculateFocalLength ã®ãƒ†ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“
```

**è§£æ±ºæ–¹æ³•**:
1. å¯¾å¿œã™ã‚‹ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
2. ãƒ†ã‚¹ãƒˆé–¢æ•°ã‚’å®Ÿè£…
3. ã¾ãŸã¯ã€privateã«å¤‰æ›´ã—ã¦å†…éƒ¨å®Ÿè£…ã¨ã™ã‚‹

#### å•é¡Œ3: ã‚³ãƒŸãƒƒãƒˆæ™‚ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

**ç—‡çŠ¶**: pre-commit hookãŒ2åˆ†ä»¥ä¸Šã‹ã‹ã‚‹

**è§£æ±ºæ–¹æ³•**:
- ä¸¦åˆ—ãƒ“ãƒ«ãƒ‰ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
- ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ“ãƒ«ãƒ‰å¯¾è±¡ã«ãªã£ã¦ã„ãªã„ã‹ç¢ºèª
- Derived Dataã‚’ã‚¯ãƒªãƒ¼ãƒ³: `rm -rf ~/Library/Developer/Xcode/DerivedData/HandEst-*`

## ğŸ“ˆ å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®æ´»ç”¨

### ç¾åœ¨ã®å“è³ªçŠ¶æ…‹ã‚’ç¢ºèª

```bash
# SwiftLintã®çµ±è¨ˆæƒ…å ±
swiftlint analyze

# ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®è©³ç´°
xcodebuild test -enableCodeCoverage YES
```

### ç¶™ç¶šçš„ãªæ”¹å–„

1. **é€±æ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼**: SwiftLintã®è­¦å‘Šæ•°ã®æ¨ç§»ã‚’ç¢ºèª
2. **æ–°æ©Ÿèƒ½è¿½åŠ æ™‚**: å¿…ãšãƒ†ã‚¹ãƒˆã‚’å…ˆã«æ›¸ãï¼ˆTDDï¼‰
3. **ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ™‚**: ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¶­æŒã¾ãŸã¯å‘ä¸Š

## ğŸ“ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

```bash
# âœ… è‰¯ã„ä¾‹ï¼ˆå…·ä½“çš„ã§æ˜ç¢ºï¼‰
git commit -m "feat: ã‚«ãƒ¡ãƒ©æ¨©é™ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¿½åŠ "

# âŒ æ‚ªã„ä¾‹ï¼ˆæ›–æ˜§ï¼‰
git commit -m "ãƒã‚°ä¿®æ­£"
```

### 2. ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹

```swift
// âœ… è‰¯ã„ãƒ†ã‚¹ãƒˆï¼ˆæ˜ç¢ºãªæœŸå¾…å€¤ã¨ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
func testCameraPermissionDenied() async {
    let store = TestStore(
        initialState: CameraFeature.State(),
        reducer: { CameraFeature() }
    )
    
    await store.send(.requestPermission)
    await store.receive(.permissionResponse(.denied)) {
        $0.permissionStatus = .denied
        $0.showPermissionAlert = true
    }
}

// âŒ æ‚ªã„ãƒ†ã‚¹ãƒˆï¼ˆæ›–æ˜§ã§ç¶²ç¾…çš„ã§ãªã„ï¼‰
func testCamera() {
    // ãƒ†ã‚¹ãƒˆå†…å®¹ãŒä¸æ˜ç¢º
}
```

### 3. å“è³ªãƒã‚§ãƒƒã‚¯ã®ã‚¹ã‚­ãƒƒãƒ—

```bash
# âš ï¸ ç·Šæ€¥æ™‚ã®ã¿ä½¿ç”¨
git commit --no-verify -m "hotfix: ç·Šæ€¥ä¿®æ­£"

# ğŸ“ ç†ç”±ã‚’æ˜è¨˜
git commit --no-verify -m "WIP: MediaPipeçµ±åˆä¸­ï¼ˆãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã‚ã‚Šï¼‰"
```

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [CLAUDE.md](../CLAUDE.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
- [.swiftlint.yml](../.swiftlint.yml) - SwiftLintã®è©³ç´°è¨­å®š
- [The Composable Architecture - Testing](https://pointfreeco.github.io/swift-composable-architecture/main/documentation/composablearchitecture/testing) - TCAã®ãƒ†ã‚¹ãƒˆã‚¬ã‚¤ãƒ‰

---

æœ€çµ‚æ›´æ–°: 2024å¹´12æœˆ28æ—¥
ä½œæˆè€…: HandEsté–‹ç™ºãƒãƒ¼ãƒ 