# タスク名: フェーズ4 - MediaPipeClient実装（詳細）

## 概要
MediaPipeClientの詳細機能を実装し、21関節点データの取得・変換、左右手判別、非同期処理を完成させる。

## 背景・目的
- 21関節点の正確なデータ取得
- 左右手判別機能の実装
- 高性能な非同期処理の実現

## 優先度
**High** - Hand Landmarker機能の核心部分

## 前提条件
- 004-03（MediaPipeClient基本）が完了していること
- HandLandmarkerの基本初期化が動作していること

## To-Be（完了条件）
- [ ] 21個の関節点データの取得と変換実装
- [ ] 3D座標データ（x,y,z）の処理実装
- [ ] 左右の手の判別機能実装（信頼度閾値0.8以上）
- [ ] 非同期処理とコールバック実装
- [ ] フレームレート制御の実装
- [ ] メモリ効率的なデータ処理
- [ ] パフォーマンス最適化
- [ ] 座標正規化の実装
- [ ] MediaPipeClientの詳細テスト作成
- [ ] 全テスト通過確認

## 実装方針
1. **データ処理パイプライン**
   ```swift
   CVPixelBuffer → MediaPipe → RawLandmarks → HandTrackingResult
   ```

2. **パフォーマンス戦略**
   - バックグラウンドキューでMediaPipe処理
   - メインキューでUI更新
   - フレームドロップ対応（30fps維持優先）

3. **品質管理**
   - 信頼度閾値による品質フィルタリング
   - 座標データの検証
   - エラー状態の適切な報告

## 成功判定基準
- 21関節点が正確に検出される
- 左右手判別が信頼度0.8以上で動作する
- 30fps以上の処理性能を維持
- 座標データが正しく正規化される
- メモリリークがない

## 想定期間
3-4日

## 関連情報
- MediaPipe Hand Landmarks仕様
- 座標系変換の詳細
- 前提チケット: 004-03-mediapipe-client-basic.md

## 作業ログ
### 2025-05-28 20:00
- **実施内容**: MediaPipeClient詳細実装の完了
- **実装項目**:
  - 信頼度閾値（0.8）による手の判別機能を実装
  - MediaPipeClientOptionsにminHandednessConfidenceパラメータを追加
  - 処理時間の正確な計測を実装
  - フレームレート制御（30fps）の実装
  - フレームドロップ機能の追加
  - 実際のフレームサイズ取得を実装
- **テスト実装**:
  - 信頼度閾値によるフィルタリングテスト
  - 処理時間とFPS計算のテスト
  - フレームレート制御のテスト
- **技術的な改善**:
  - 低信頼度の手を除外する処理を追加
  - 目標FPSを超える場合のフレームスキップ処理
  - 処理中フラグによるフレームドロップ機能
- **結果**: 全テスト通過確認済み
- **次のステップ**: 004-05-handtracking-feature.mdの実装